#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ MongoDB..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ –±–æ—Ç
if ! curl -s http://localhost:8080/webhook > /dev/null 2>&1; then
    echo "‚ùå –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ –∫–æ–º–∞–Ω–¥–æ–π: go run ./cmd/bot"
    exit 1
fi

echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è..."
echo ""

# –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (—Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–π —á–∞—Ç)
echo "üì© –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
curl -X POST http://localhost:8080/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "update_id": 100001,
    "message": {
      "message_id": 10,
      "from": {
        "id": 987654,
        "is_bot": false,
        "first_name": "–ê–Ω–Ω–∞",
        "last_name": "–ü–µ—Ç—Ä–æ–≤–∞",
        "username": "anna_p"
      },
      "chat": {
        "id": 987654,
        "type": "private"
      },
      "date": 1640995200,
      "text": "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ."
    }
  }' > /dev/null 2>&1

sleep 1

# –í—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤ —Ç–æ–º –∂–µ —á–∞—Ç–µ)
echo "üì© –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–æ—Ç –∂–µ —á–∞—Ç..."
curl -X POST http://localhost:8080/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "update_id": 100002,
    "message": {
      "message_id": 11,
      "from": {
        "id": 987654,
        "is_bot": false,
        "first_name": "–ê–Ω–Ω–∞",
        "last_name": "–ü–µ—Ç—Ä–æ–≤–∞",
        "username": "anna_p"
      },
      "chat": {
        "id": 987654,
        "type": "private"
      },
      "date": 1640995260,
      "text": "–ê —ç—Ç–æ –≤—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–æ–º –∂–µ —á–∞—Ç–µ."
    }
  }' > /dev/null 2>&1

sleep 1

# –¢—Ä–µ—Ç—å–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–æ–≤—ã–π —á–∞—Ç)
echo "üì© –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–æ–≤—ã–π —á–∞—Ç)..."
curl -X POST http://localhost:8080/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "update_id": 100003,
    "message": {
      "message_id": 20,
      "from": {
        "id": 111222,
        "is_bot": false,
        "first_name": "–ò–≤–∞–Ω",
        "username": "ivan_test"
      },
      "chat": {
        "id": 111222,
        "type": "private"
      },
      "date": 1640995320,
      "text": "–ü—Ä–∏–≤–µ—Ç –æ—Ç –ò–≤–∞–Ω–∞!"
    }
  }' > /dev/null 2>&1

echo ""
echo "‚úÖ –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!"
echo "üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:"
echo "   ‚Ä¢ 2 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —á–∞—Ç–∞ (–ê–Ω–Ω–∞ –∏ –ò–≤–∞–Ω)"
echo "   ‚Ä¢ 3 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è"
echo "   ‚Ä¢ –î–ª—è –≤—Ç–æ—Ä–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ê–Ω–Ω—ã –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å '–ß–∞—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'"
echo ""

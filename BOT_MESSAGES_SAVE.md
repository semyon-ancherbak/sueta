# Обновление: Сохранение сообщений от бота

## Проблема
Ранее в базе данных сохранялись только входящие сообщения от пользователей, которые приходили через Telegram webhook. Сообщения, отправляемые ботом пользователям, не сохранялись в базе данных.

## Решение
Реализована логика сохранения сообщений от бота в базу данных после их успешной отправки через Telegram API.

## Изменения

### 1. Обновлен `internal/telegram/client.go`
- Добавлено поле `repo repository.Repository` в структуру `Client`
- Обновлен конструктор `NewClient()` для принятия репозитория
- Добавлен метод `saveBotMessage()` для сохранения сообщений от бота
- Обновлен метод `SendMessage()` для автоматического сохранения отправленных сообщений

### 2. Обновлен `cmd/bot/main.go`
- Изменен вызов `telegram.NewClient()` для передачи репозитория

### 3. Обновлен `internal/handler/webhook.go`
- Добавлены проверки на nil указатели для безопасности в тестах
- Улучшена обработка ошибок при работе с Telegram клиентом

### 4. Исправлены тесты
- Исправлен `internal/handler/webhook_bot_test.go` - изменена функция с `isMessageForBot` на `containsTolikVariation`
- Добавлены новые тесты в `internal/telegram/client_test.go` для проверки сохранения сообщений от бота

## Поведение

### До изменений:
1. Пользователь отправляет сообщение → сохраняется в БД
2. Бот отправляет ответ → НЕ сохраняется в БД

### После изменений:
1. Пользователь отправляет сообщение → сохраняется в БД
2. Бот отправляет ответ → сохраняется в БД с флагом `IsBot: true`

## Особенности реализации

- Сообщения от бота помечаются флагом `IsBot: true`
- Для сообщений бота `UpdateID` устанавливается в 0 (так как они не приходят через webhook)
- Если сохранение сообщения бота не удается, это логируется, но не приводит к ошибке отправки
- Добавлены проверки на nil указатели для безопасной работы в тестах

## Тестирование

Добавлены unit-тесты для проверки:
- Корректного сохранения сообщений от бота
- Обработки edge cases (nil message, nil repository)
- Правильной установки флагов и метаданных

Все существующие тесты продолжают работать корректно.
